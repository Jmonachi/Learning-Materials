!function(){function e(e,n){C=this,a.settings=$.extend(!0,{},a.defaults,n),U("SALT-N-PEPA || Init");var r={id:A(),url:window.location.href,path:window.location.pathname};return window.history.replaceState(r,"",window.location.href),d(),this.on("click.saltnpepa",e,function(e){t(e,n)})}function t(e,t){var n=e.currentTarget;if("A"!==n.tagName.toUpperCase())throw"this is not an anchor element";if(!(e.which>1||e.metaKey||e.ctrlKey||e.shiftKey||e.altKey||location.protocol!==n.protocol||location.hostname!==n.hostname||n.hash&&n.href.replace(n.hash,"")===location.href.replace(location.hash,"")||n.href===location.href+"#"||e.isDefaultPrevented())){var r={url:n.href,path:n.pathname,target:n};$(n).trigger("saltnpepa:click",[r]),a(r,!0),e.preventDefault()}}function n(e,t){var n=e.currentTarget;if("FORM"!==n.tagName.toUpperCase())throw"$.saltnpepa.submit requires a form element";var r=$(n).serialize(),o=$(n).attr("action")+r,s={type:n.method.toUpperCase(),url:o,target:n};a($.extend({},s,t),!0),e.preventDefault()}function a(e,t){if(e=$.extend(!0,{},$.ajaxSettings,a.settings,e),e.data||(e.data={}),e.data._saltnpepa="partial",!t||e.url!=window.location.href){var n,r=N(e.url);o(),e.beforeSend=function(t,a){I=A()+"",t.setRequestHeader("X-Saltnpepa",I),"GET"!==a.type&&(a.timeout=0),a.timeout>0&&(n=setTimeout(function(){x("saltnpepa:timeout",[t,a]),t.abort("timeout")},a.timeout),a.timeout=0),e.requestUrl=_(a.url).href},e.complete=function(t,a){n&&clearTimeout(n),x("saltnpepa:complete",[t,a,e]),x("saltnpepa:end",[t,e])},e.error=function(t,n,a){U("SALT-N-PEPA || ERROR!!!! "),U(a);var r=b(t,e);x("saltnpepa:error",[t,n,a,e]),"GET"==e.type&&"abort"!==n&&R(r)},e.success=function(t,n,a){var r=b(a,e);if(!E(t,a))return void R(r);l(t,e)},t&&p(e.url,e.path);var s=f(r);if(s){var i=s.html;return U("SALT-N-PEPA || REQUEST: CACHE HIT "),l(i,e,t)}var c=a.xhr;c&&c.readyState<4&&(c.onreadystatechange=$.noop,c.abort());var c=a.xhr=$.ajax(e);return c.readyState>0&&(C.trigger("saltnpepa:start",[c,e]),C.trigger("saltnpepa:send",[c,e])),U("SALT-N-PEPA || REQUEST: XHR "),a.xhr}}function r(){s(!1)}function o(){s(!0)}function s(e){var t="popstate.saltnpepa";e?$(window).off(t).on(t,i):$(window).off(t)}function i(e){U("SALT-N-PEPA|| POPSTATE");var t=e.state;if(t&&t.url){a({id:t.id,url:t.url,path:t.path,scrollTo:!1},!1)}}function p(e,t){U("SALT-N-PEPA|| PUSHSTATE");var n={id:A(),url:e,path:t};window.history.pushState(n,"",H(e))}function l(e,t,n){var r=t.url,o=t.path;A();U("SALT-N-PEPA || SUCCESS "),C.trigger("saltnpepa:page_preload",[e,t]);var s=function(){if(!1!==a.settings.scrollTo&&$(window).scrollTop(a.settings.scrollTo),""!==t.hash){var n=_(t.requestUrl);n.hash=t.hash;var r=$(n.hash);r.length&&$(window).scrollTop(r.offset().top)}C.trigger("saltnpepa:page_load",[e,t])};window.editorialConfig&&window.editorialConfig.deferSnp?window.editorialConfig.deferSnp(s):s()}function c(e){if(!e)return!1;if(v(e))return!1;var t=new XMLHttpRequest;I=A(),t.onreadystatechange=function(){4==t.readyState&&200==t.status&&E(t.responseText,t)&&h(e,t.responseText)},t.open("GET",e,!0),t.setRequestHeader("X-Saltnpepa",I),t.send()}function u(){return T("list",null,null)}function f(e){if(e){var t=T("get",e,null);return t&&A()>t.expiration&&(t=!1,g([e])),t}return!1}function h(e,t){var n=N(e);if(n&&t){var a={};a.html=t,a.expiration=P(),T("set",n,a),S(),U("SALT-N-PEPA || cacheSet - "+n)}}function g(e){for(var t=e.length,n=0;n<t;n++)T("delete",e[n],null)}function d(){g(u())}function S(){var e=u(),t=[],n=e.length-a.settings.cacheMax;n<1&&(n=0);for(var r=0;r<n;r++)t.push(e[r]);g(t)}function v(e){return!!f(N(e))}function m(){return!(!a.settings||"session"!==a.settings.cacheType||!q)&&"session"}function T(e,t,n){if("session"===m()&&"undefined"!=typeof sessionStorage)switch(e){case"get":return L(sessionStorage.getItem(t));case"set":sessionStorage.setItem(t,JSON.stringify(n));break;case"list":for(var r={},o=sessionStorage.length,s=0;s<o;s++){var t=sessionStorage.key(s),i=a.settings?a.settings.cachePrefix:"saltnpepa_",p=new RegExp("^"+i,"g");t.match(p)&&(r[t]=L(sessionStorage.getItem(t)))}return w(r);case"delete":sessionStorage.removeItem(t)}else switch(e){case"get":return X[t]||!1;case"set":X[t]=n;break;case"list":return w(X);case"delete":delete X[t]}}function w(e){var t=[],n=[];for(var a in e)n.push([a,e[a]]);n.sort(function(e,t){return e[1].expiration-t[1].expiration});for(var r=n.length,o=0;o<r;o++)t.push(n[o][0]);return t}function P(){var e=a.settings.cacheTime;return A()+6e4*e}function y(){return $("meta").filter(function(){var e=$(this).attr("name");return e&&"X-Site-Version"===e}).attr("content")}function E(e,t){var n=t.getResponseHeader("X-Site-Version"),a=t.getResponseHeader("X-Saltnpepa"),r=y();return a==I&&(!!e&&n===r)}function A(){return(new Date).getTime()}function x(e,t,n){var a=$.Event(e,{relatedTarget:n});C.trigger(a,t)}function R(e){U("SALT-N-PEPA || Hard Refresh"),window.history.replaceState(null,"","#"),window.location.replace(e)}function N(e){return e=H(e),e=e.replace(/^.*\/\/[^\/]+/,""),e=e.replace(/\//,""),e="/"+e.replace(/\W+/g,"_"),(a.settings?a.settings.cachePrefix:"saltnpepa_")+e}function b(e,t){return H(e.getResponseHeader("X-saltnpepa-URL")||t.requestUrl)}function _(e){var t=document.createElement("a");return t.href=e,t}function H(e){return e.replace(/\?_saltnpepa=[^&]+&?/,"?").replace(/_saltnpepa=[^&]+&?/,"").replace(/&?_=[0-9]*/,"").replace(/[\?&]$/,"")}function L(e){try{return JSON.parse(e)}catch(e){return!1}}function U(e){a&&a.settings&&a.settings.debug&&(console.log(e),console.log("========================================"))}var C,I,X={},q=function(){try{return sessionStorage.setItem("test_session",""),sessionStorage.removeItem("test_session"),!0}catch(e){return!1}}();$.inArray("state",$.event.props)<0&&$.event.props.push("state"),function(){$.fn.saltnpepa=e,$.saltnpepa=a,$.saltnpepa.defaults={timeout:5e3,type:"GET",dataType:"html",scrollTo:0,caching:!0,cacheType:"session",cacheMax:3,cacheTime:10,cachePrefix:"saltnpepa_",debug:!1},$.saltnpepa.submit=n,$.saltnpepa.prefetch=c,$.saltnpepa.pushState=p,$.saltnpepa.disablePopState=r,$.saltnpepa.enablePopState=o,o()}()}();